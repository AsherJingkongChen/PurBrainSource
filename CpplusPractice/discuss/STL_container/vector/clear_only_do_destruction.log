==57445== Memcheck, a memory error detector
==57445== Copyright (C) 2002-2017, and GNU GPL'd, by Julian Seward et al.
==57445== Using Valgrind-3.19.0.GIT-lbmacos and LibVEX; rerun with -h for copyright info
==57445== Command: ./test
==57445== 
<L     1-> | <DECL> audio_track::ctor0  ()
u ----  main  ---- u
<L     2-> | <ALOC> byte_buffer::ctorA (size_t _num_frames)
<L     3-> | <MOVE> byte_buffer::mvctor (byte_buffer&& _src)
<L     4-> | <PUSH> audio_track::append (audio_buffer&& _rhs) | num_buffers=1
<L     5-> | <DLOC> byte_buffer::destor ()
<L     6-> | <INFO> audio_track::get_num_buffers () | SIZ   1 . CAP  10
n ----  update  ---- n
<L     7-> | <ALOC> byte_buffer::ctorA (size_t _num_frames)
<L     8-> | <MOVE> byte_buffer::mvctor (byte_buffer&& _src)
<L     9-> | <PUSH> audio_track::append (audio_buffer&& _rhs) | num_buffers=2
<L    10-> | <DLOC> byte_buffer::destor ()
<L    11-> | <INFO> audio_track::get_num_buffers () | SIZ   2 . CAP  10
n ----  update  ---- n
<L    12-> | <ALOC> byte_buffer::ctorA (size_t _num_frames)
<L    13-> | <MOVE> byte_buffer::mvctor (byte_buffer&& _src)
<L    14-> | <PUSH> audio_track::append (audio_buffer&& _rhs) | num_buffers=3
<L    15-> | <DLOC> byte_buffer::destor ()
<L    16-> | <INFO> audio_track::get_num_buffers () | SIZ   3 . CAP  10
n ----  update  ---- n
<L    17-> | <ALOC> byte_buffer::ctorA (size_t _num_frames)
<L    18-> | <MOVE> byte_buffer::mvctor (byte_buffer&& _src)
<L    19-> | <PUSH> audio_track::append (audio_buffer&& _rhs) | num_buffers=4
<L    20-> | <DLOC> byte_buffer::destor ()
<L    21-> | <INFO> audio_track::get_num_buffers () | SIZ   4 . CAP  10
n ----  update  ---- n
<L    22-> | <ALOC> byte_buffer::ctorA (size_t _num_frames)
<L    23-> | <MOVE> byte_buffer::mvctor (byte_buffer&& _src)
<L    24-> | <PUSH> audio_track::append (audio_buffer&& _rhs) | num_buffers=5
<L    25-> | <DLOC> byte_buffer::destor ()
<L    26-> | <INFO> audio_track::get_num_buffers () | SIZ   5 . CAP  10
n ----  update  ---- n
<L    27-> | <ALOC> byte_buffer::ctorA (size_t _num_frames)
<L    28-> | <MOVE> byte_buffer::mvctor (byte_buffer&& _src)
<L    29-> | <PUSH> audio_track::append (audio_buffer&& _rhs) | num_buffers=6
<L    30-> | <DLOC> byte_buffer::destor ()
<L    31-> | <INFO> audio_track::get_num_buffers () | SIZ   6 . CAP  10
n ----  update  ---- n
<L    32-> | <ALOC> byte_buffer::ctorA (size_t _num_frames)
<L    33-> | <MOVE> byte_buffer::mvctor (byte_buffer&& _src)
<L    34-> | <PUSH> audio_track::append (audio_buffer&& _rhs) | num_buffers=7
<L    35-> | <DLOC> byte_buffer::destor ()
<L    36-> | <INFO> audio_track::get_num_buffers () | SIZ   7 . CAP  10
n ----  update  ---- n
<L    37-> | <ALOC> byte_buffer::ctorA (size_t _num_frames)
<L    38-> | <MOVE> byte_buffer::mvctor (byte_buffer&& _src)
<L    39-> | <PUSH> audio_track::append (audio_buffer&& _rhs) | num_buffers=8
<L    40-> | <DLOC> byte_buffer::destor ()
<L    41-> | <INFO> audio_track::get_num_buffers () | SIZ   8 . CAP  10
n ----  update  ---- n
<L    42-> | <ALOC> byte_buffer::ctorA (size_t _num_frames)
<L    43-> | <MOVE> byte_buffer::mvctor (byte_buffer&& _src)
<L    44-> | <PUSH> audio_track::append (audio_buffer&& _rhs) | num_buffers=9
<L    45-> | <DLOC> byte_buffer::destor ()
<L    46-> | <INFO> audio_track::get_num_buffers () | SIZ   9 . CAP  10
n ----  update  ---- n
<L    47-> | <ALOC> byte_buffer::ctorA (size_t _num_frames)
<L    48-> | <MOVE> byte_buffer::mvctor (byte_buffer&& _src)
<L    49-> | <PUSH> audio_track::append (audio_buffer&& _rhs) | num_buffers=10
<L    50-> | <DLOC> byte_buffer::destor ()
<L    51-> | <INFO> audio_track::get_num_buffers () | SIZ  10 . CAP  10
n ----  update  ---- n
<L    52-> | <DLOC> byte_buffer::destor ()
<L    53-> | <DLOC> byte_buffer::destor ()
<L    54-> | <DLOC> byte_buffer::destor ()
<L    55-> | <DLOC> byte_buffer::destor ()
<L    56-> | <DLOC> byte_buffer::destor ()
<L    57-> | <DLOC> byte_buffer::destor ()
<L    58-> | <DLOC> byte_buffer::destor ()
<L    59-> | <DLOC> byte_buffer::destor ()
<L    60-> | <DLOC> byte_buffer::destor ()
<L    61-> | <DLOC> byte_buffer::destor ()
<L    62-> | <INFO> audio_track::get_num_buffers () | SIZ   0 . CAP  10
n ----  clear  ---- n
<L    63-> | <ALOC> byte_buffer::ctorA (size_t _num_frames)
<L    64-> | <MOVE> byte_buffer::mvctor (byte_buffer&& _src)
<L    65-> | <PUSH> audio_track::append (audio_buffer&& _rhs) | num_buffers=11
<L    66-> | <DLOC> byte_buffer::destor ()
<L    67-> | <INFO> audio_track::get_num_buffers () | SIZ   1 . CAP  10
n ----  update again  ---- n
n ----  return 0  ---- n
<L    68-> | <DLOC> audio_track::destor ()
<L    69-> | <DLOC> byte_buffer::destor ()
==57445== 
==57445== HEAP SUMMARY:
==57445==     in use at exit: 17,935 bytes in 160 blocks
==57445==   total heap usage: 186 allocs, 26 frees, 24,951 bytes allocated
==57445== 
==57445== LEAK SUMMARY:
==57445==    definitely lost: 0 bytes in 0 blocks
==57445==    indirectly lost: 0 bytes in 0 blocks
==57445==      possibly lost: 0 bytes in 0 blocks
==57445==    still reachable: 2,048 bytes in 1 blocks
==57445==         suppressed: 15,887 bytes in 159 blocks
==57445== Reachable blocks (those to which a pointer was found) are not shown.
==57445== To see them, rerun with: --leak-check=full --show-leak-kinds=all
==57445== 
==57445== For lists of detected and suppressed errors, rerun with: -s
==57445== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 5 from 5)
#include "audio_track.h"
#include "lockfree_task_queue.h"

static constexpr inline size_t
BUFS_APPEND = 10;

int main()
{
    audio_track TK;
    mark_("main");

    TK.prealloc(BUFS_APPEND);

    /* push new buffers */
    for (size_t I = BUFS_APPEND; I--;)
    {
        TK.append(audio_buffer(96));
        TK.get_num_buffers();
        _mark("update");
    }

    TK.clear();
    TK.get_num_buffers();
    _mark("clear");

    TK.append(audio_buffer(96));
    TK.get_num_buffers();
    _mark("update again");

    _mark("return 0");
    return 0;
}
